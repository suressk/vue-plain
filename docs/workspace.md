# Monorepo

- ä½¿ç”¨ [`pnpm` ğŸ”—](https://www.pnpm.cn/) åš `Monorepo` åŒ…ç®¡ç†å·¥å…·

- é¡¹ç›®æ ¹è·¯å¾„ä¸‹åˆ›å»º `pnpm-worksapce.yaml` æ–‡ä»¶ï¼š

    ```yaml
    # æŒ‡å®šåˆ†åŒ…è·¯å¾„
    # packages ç›®å½•ä¸‹çš„æ‰€æœ‰åŒ…å•ç‹¬ç®¡ç†
    packages:
        - 'packages/*'
    ```

- `packages` ç›®å½•ä¸‹çš„æ¯ä¸€ä¸ªå­åŒ…ï¼Œé€šè¿‡ `package.json` æ–‡ä»¶æ¥é…ç½®æˆ‘ä»¬éœ€è¦ç”¨åˆ°çš„å±æ€§

    ```json
    {
        /* ç”¨äºåŒºåˆ†å„ä¸ªå­åŒ… */
        "name": "@[ä¸»åŒ…å]/[å½“å‰å­åŒ…å]",
        /* è‡ªå®šä¹‰æ‰“åŒ…é…ç½® */
        "buildOptions": {
            /* æ‰“åŒ…è¾“å‡ºåŒ…åï¼ˆä¸€èˆ¬å¤§é©¼å³°å‘½åï¼‰ */
            "name": "[è‡ªå®šä¹‰åŒ…å]",
            /* æ‰“åŒ…è¾“å‡ºä»£ç è§„èŒƒ */
            "formats": [
                "global",
                "esm-bundler",
                "cjs"
            ]
        },
        // ... others
    }
    ```

- æˆ‘ä»¬ç”¨åˆ°äº† `typescript`ï¼Œæ‰€ä»¥é…ç½® `tsconfig.json`ï¼ˆæ ¹ç›®å½•ä¸‹åˆ›å»ºï¼‰ï¼Œé¿å…æˆ‘ä»¬åœ¨ä½¿ç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„å­åŒ…æ—¶æ‰¾ä¸åˆ°æ–‡ä»¶çš„é—®é¢˜

    ```json
    {
        "compilerOptions": {
            // ... others config
            "baseUrl": ".",
            /*
             è¿™æ ·ï¼Œæˆ‘ä»¬åœ¨ä»£ç é‡Œ
             import {xxx} from '@[ä¸»åŒ…å]/xxx'
             æ—¶å°±å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶äº†ï¼Œå¦åˆ™å°±ä¼šæ‰¾ä¸åˆ°æ–‡ä»¶è€ŒæŠ¥é”™
             */
            "paths": {
                "@[ä¸»åŒ…å]/*": ["packages/*/src"]
            },
            "outDir": "dist",
        },
        "include": [
            "packages/*/src"
        ]
    }
    ```

- é€šè¿‡è‡ªå®šä¹‰ shell å‘½ä»¤ï¼Œç»“åˆ node ä½¿ç”¨ `esbuild` å¯¹å¼€å‘ç¯å¢ƒé˜¶æ®µçš„ä»£ç è¿›è¡Œæ‰“åŒ…è½¬åŒ–è¾“å‡º

    ```shell
    node scripts/dev.js [å­åŒ…å] -f [formats è§„èŒƒ]
    ```

    æ‰§è¡Œ `scripts/dev.js` æ–‡ä»¶ï¼Œé€šè¿‡ `minimist` åŒ…è§£æ shell å‘½ä»¤å‚æ•°ï¼Œå†æ‹¿åˆ°æ¯ä¸ªå­åŒ…çš„ `package.json` æ–‡ä»¶å†…å®¹ï¼Œå–å‡ºæˆ‘ä»¬è‡ªå·±çš„ `buildOptions` é…ç½®ï¼Œä½¿ç”¨ `esbuild.build` æ–¹æ³•æ‰“åŒ…è¾“å‡ºå³å¯
